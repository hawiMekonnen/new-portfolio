(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,676452,798864,79747,e=>{"use strict";e.s(["useHighlightsStore",()=>c],676452),e.i(708274);var t=e.i(868275),s=e.i(486492),i=e.i(564448),r=e.i(364778),o=e.i(332573),l=e.i(477249);function n(e){return{storyId:e.name||"unknown-trend",title:e.name||"Trending Topic",summary:e.hook||"",createTime:e.createTime,updateTime:e.createTime,followups:[],grokAnalysis:e.summary||""}}e.s(["useTrendsStore",()=>h],79747),e.s(["convertTrendToHighlightsStory",()=>n],798864);class a{constructor(e,o,l){var a=this;(0,t._)(this,"set",void 0),(0,t._)(this,"get",void 0),(0,t._)(this,"store",void 0),(0,t._)(this,"allTrends",void 0),(0,t._)(this,"visibleTrends",void 0),(0,t._)(this,"isLoading",void 0),(0,t._)(this,"error",void 0),(0,t._)(this,"nextCursor",void 0),(0,t._)(this,"setAllTrends",void 0),(0,t._)(this,"setVisibleTrends",void 0),(0,t._)(this,"setIsLoading",void 0),(0,t._)(this,"setError",void 0),(0,t._)(this,"setNextCursor",void 0),(0,t._)(this,"fetchTrends",void 0),(0,t._)(this,"fetchMoreTrends",void 0),(0,t._)(this,"loadMoreVisibleTrends",void 0),(0,t._)(this,"reset",void 0),this.set=e,this.get=o,this.store=l,this.allTrends=[],this.visibleTrends=[],this.isLoading=!1,this.error=null,this.nextCursor=void 0,this.setAllTrends=(0,i.assign)(this.set,"allTrends"),this.setVisibleTrends=(0,i.assign)(this.set,"visibleTrends"),this.setIsLoading=(0,i.assign)(this.set,"isLoading"),this.setError=(0,i.assign)(this.set,"error"),this.setNextCursor=(0,i.assign)(this.set,"nextCursor"),this.fetchTrends=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;a.setIsLoading(!0),a.setError(null);try{let t=await r.trendsApi.trendsGetPersonalizedTrends({limit:e,includePosts:!0,includePostInfo:!0,includeAuthorInfo:!0,numPosts:5}),s=a.get(),i=t.trends||[],o=new Set(s.allTrends.map(e=>e.name)),l=i.filter(e=>!o.has(e.name)),h=c.getState();l.forEach(e=>{e.posts&&e.posts.length>0&&h.setSourcePostsByStoryId(e.name||"unknown-trend",e.posts)});let d=l.map(n);h.setStories([...h.stories,...d]);let u=[...l,...s.allTrends];a.set({allTrends:u,visibleTrends:u,nextCursor:void 0,isLoading:!1})}catch(t){let e=t instanceof Error?t:Error("Failed to fetch trends");a.set({error:e,isLoading:!1}),(0,s.logError)("trends-store:fetchTrends",t)}},this.fetchMoreTrends=async()=>{},this.loadMoreVisibleTrends=()=>{let e=this.get(),t=e.visibleTrends.length,s=e.allTrends.slice(t,t+20);s.length>0&&this.set({visibleTrends:[...e.visibleTrends,...s]})},this.reset=()=>{this.set({allTrends:[],visibleTrends:[],isLoading:!1,error:null,nextCursor:void 0})}}}let h=(0,o.create)()((0,l.devtools)((e,t,s)=>new a(e,t,s),{name:"useTrendsStore"}));class d{constructor(e,o,l){var a=this;(0,t._)(this,"set",void 0),(0,t._)(this,"get",void 0),(0,t._)(this,"store",void 0),(0,t._)(this,"stories",void 0),(0,t._)(this,"isLoading",void 0),(0,t._)(this,"error",void 0),(0,t._)(this,"nextCursor",void 0),(0,t._)(this,"storyReactions",void 0),(0,t._)(this,"sourcePostsByStoryId",void 0),(0,t._)(this,"setStories",void 0),(0,t._)(this,"setIsLoading",void 0),(0,t._)(this,"setError",void 0),(0,t._)(this,"setNextCursor",void 0),(0,t._)(this,"setStoryReaction",void 0),(0,t._)(this,"setSourcePostsByStoryId",void 0),(0,t._)(this,"getSourcePostsByStoryId",void 0),(0,t._)(this,"likeStory",void 0),(0,t._)(this,"dislikeStory",void 0),(0,t._)(this,"fetchStories",void 0),(0,t._)(this,"fetchMoreStories",void 0),(0,t._)(this,"getStory",void 0),(0,t._)(this,"reset",void 0),this.set=e,this.get=o,this.store=l,this.stories=[],this.isLoading=!1,this.error=null,this.nextCursor=void 0,this.storyReactions={},this.sourcePostsByStoryId={},this.setStories=(0,i.assign)(this.set,"stories"),this.setIsLoading=(0,i.assign)(this.set,"isLoading"),this.setError=(0,i.assign)(this.set,"error"),this.setNextCursor=(0,i.assign)(this.set,"nextCursor"),this.setStoryReaction=(e,t)=>{this.set(s=>({storyReactions:{...s.storyReactions,[e]:t}}))},this.setSourcePostsByStoryId=(e,t)=>{this.set(s=>({sourcePostsByStoryId:{...s.sourcePostsByStoryId,[e]:t}}))},this.getSourcePostsByStoryId=e=>this.get().sourcePostsByStoryId[e],this.likeStory=e=>{let t=this.get().storyReactions[e];this.setStoryReaction(e,"liked"===t?null:"liked")},this.dislikeStory=e=>{let t=this.get().storyReactions[e];this.setStoryReaction(e,"disliked"===t?null:"disliked")},this.fetchStories=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;a.setIsLoading(!0),a.setError(null);try{let t=await r.highlightsApi.highlightsGetStories({limit:e}),s=a.get(),i=t.stories||[],o=new Set(s.stories.map(e=>e.storyId)),l=i.filter(e=>!o.has(e.storyId));a.set({stories:[...l,...s.stories],nextCursor:t.nextCursor,isLoading:!1})}catch(t){let e=t instanceof Error?t:Error("Failed to fetch highlights");a.set({error:e,isLoading:!1}),(0,s.logError)("highlights-store:fetchStories",t)}},this.fetchMoreStories=async()=>{let e=this.get();if(!e.isLoading&&e.nextCursor){this.setIsLoading(!0),this.setError(null);try{let t=await r.highlightsApi.highlightsGetStories({limit:10,cursor:e.nextCursor}),s=t.stories||[],i=new Set(e.stories.map(e=>e.storyId)),o=s.filter(e=>!i.has(e.storyId));this.set({stories:[...e.stories,...o],nextCursor:t.nextCursor,isLoading:!1})}catch(t){let e=t instanceof Error?t:Error("Failed to load more highlights");this.set({error:e,isLoading:!1}),(0,s.logError)("highlights-store:loadMore",t)}}},this.getStory=async e=>{let t=this.get().stories.find(t=>t.storyId===e);if(t)return Promise.resolve(t);let i=h.getState().allTrends.find(t=>t.name===e);if(i){let e=n(i);return this.set(t=>({stories:[...t.stories,e]})),e}try{let t=(await r.highlightsApi.highlightsGetStory({storyId:e})).story;if(!t)throw Error("Story not found");return this.set(e=>({stories:e.stories.some(e=>e.storyId===t.storyId)?e.stories:[...e.stories,t]})),t}catch(e){throw(0,s.logError)("highlights-store:getStory",e),e}},this.reset=()=>{this.set({stories:[],isLoading:!1,error:null,nextCursor:void 0,sourcePostsByStoryId:{}})}}}let c=(0,o.create)()((0,l.devtools)((0,l.persist)((e,t,s)=>new d(e,t,s),{name:"highlights-storage",partialize:e=>({storyReactions:e.storyReactions})}),{name:"useHighlightsStore"}))},398459,112089,e=>{"use strict";e.s(["HighlightsSection",()=>T,"HighlightsStoryRow",()=>C],398459);var t=e.i(637651),s=e.i(824027),i=e.i(981176);e.i(685846);var r=e.i(660621),o=e.i(526697),l=e.i(296451),n=e.i(19945),a=e.i(883440),h=e.i(235289),d=e.i(763578),c=e.i(410289),u=e.i(723008),g=e.i(920958),m=e.i(486492),y=e.i(165275),x=e.i(211959),f=e.i(353315);e.i(968648);var p=e.i(873329),v=e.i(713216),S=e.i(676452);e.s(["useEngagingPosts",()=>N,"useLoadDiscussionPosts",()=>k,"useSourcePosts",()=>w],112089);var j=e.i(364778);e.i(298616);var I=e.i(111669),b=e.i(910503);function w(e){var t;let s=(0,S.useHighlightsStore)();return(0,b.useQuery)({queryKey:["highlights","source-posts",e],queryFn:async()=>{var t,i;if(!e)return[];let r=(null==(i=(await j.highlightsApi.highlightsGetSourcePosts({body:{storyIds:[e]}})).storyPosts)||null==(t=i[0])?void 0:t.posts)||[];return s.setSourcePostsByStoryId(e,r),r},enabled:!!e&&!(null==(t=s.getSourcePostsByStoryId(e))?void 0:t.length),staleTime:3e5,gcTime:6e5,initialData:()=>e?s.getSourcePostsByStoryId(e):[]})}function N(e){return(0,b.useQuery)({queryKey:["highlights","engaging-posts",e],queryFn:async()=>e&&(await j.highlightsApi.highlightsGetEngagingPosts({storyId:e})).engagingPosts||[],enabled:!!e,staleTime:3e5,gcTime:6e5})}function k(e){var t;let s=(0,I.useInfiniteQuery)({queryKey:["highlights","discussion-posts",e],queryFn:async t=>{let{pageParam:s}=t;if(!e)throw Error("Story ID is required");let i=await j.highlightsApi.highlightsGetDiscussionPosts({storyId:e,limit:20,cursor:s});return{discussionPosts:i.discussionPosts||[],nextCursor:i.nextCursor||void 0}},initialPageParam:void 0,getNextPageParam:e=>e.nextCursor,enabled:!!e,staleTime:3e5,gcTime:6e5});return{discussionPosts:(null==(t=s.data)?void 0:t.pages.flatMap(e=>e.discussionPosts))||[],isLoading:s.isLoading,error:s.error,hasMore:s.hasNextPage,loadMore:s.fetchNextPage,isFetchingNextPage:s.isFetchingNextPage}}var _=e.i(623434);function C(e){var s,i,h,u,v,j,I;let{story:b,onClick:N,borderless:k,mode:C="embedded",type:T="highlight"}=e,[L,P]=(0,f.useState)(!1),M=(0,g.useLogEvent)(),{t:E}=(0,p.useTranslation)("chat"),A=(0,S.useHighlightsStore)(e=>e.storyReactions),{data:H=[],isLoading:R}=w(b.storyId),B=(0,f.useMemo)(()=>H.filter(e=>{var t;return(null==(t=e.entities)?void 0:t.media)&&e.entities.media.length>0}).sort((e,t)=>{var s,i;return((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)})[0]||H[0],[H]),D=null==B||null==(h=B.entities)||null==(i=h.media)||null==(s=i[0])?void 0:s.url,z=(null==B||null==(j=B.entities)||null==(v=j.media)||null==(u=v[0])?void 0:u.previewImageUrl)||D,F=z&&!L,U=A[b.storyId||""],O=(0,f.useMemo)(()=>{if(R||0===H.length)return;let e=H.reduce((e,t)=>Math.max(e,new Date(t.createTime||0).getTime()),0),t=Math.floor((Date.now()-e)/6e4);return 0===t?E("highlights-less-than-minute-ago","<1 minute ago"):t<60?E("highlights-minutes-ago","{{count}} minutes ago",{count:t}):E("highlights-hours-ago","{{count}} hours ago",{count:Math.floor(t/60)})},[H,E,R]),V=(0,f.useMemo)(()=>H.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[H]),X=(0,f.useMemo)(()=>H.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)},0),[H]),G=(0,f.useMemo)(()=>{let e=new Map;return H.forEach(t=>{if(t.username){var s;let i=(null==(s=t.publicMetrics)?void 0:s.likeCount)||0,r=e.get(t.username);r?i>r.maxLikeCount&&(r.maxLikeCount=i,r.postId=t.postId,!r.verifiedType&&t.verifiedType&&(r.verifiedType=t.verifiedType)):e.set(t.username,{name:t.name||"",username:t.username||"",profileImageUrl:t.profileImageUrl,verifiedType:t.verifiedType,maxLikeCount:i,postId:t.postId})}}),Array.from(e.values()).sort((e,t)=>t.maxLikeCount-e.maxLikeCount)},[H]),q=(0,f.useCallback)(e=>{if(!b.storyId)return void(0,m.logError)("highlights-story-card:HighlightsStoryRow:handleClick","storyId is undefined",{story:JSON.stringify(b)});M("highlights_story_tapped",b.storyId,{location:"highlights-story-card:HighlightsStoryRow:click",storyId:b.storyId,title:b.title||""}),e.metaKey||e.ctrlKey||(e.preventDefault(),N(b.storyId))},[b,M,N]),Q=(0,f.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!b.storyId)return;let t=S.useHighlightsStore.getState();M("highlight_story_liked",b.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleLike",storyId:b.storyId,title:b.title||"",wasAlreadyLiked:String("liked"===U)}),t.likeStory(b.storyId)},[b.storyId,b.title,U,M]),W=(0,f.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!b.storyId)return;let t=S.useHighlightsStore.getState();M("highlight_story_disliked",b.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleDislike",storyId:b.storyId,title:b.title||"",wasAlreadyDisliked:String("disliked"===U)}),t.dislikeStory(b.storyId)},[b.storyId,b.title,U,M]),K=(0,f.useMemo)(()=>G.slice(0,3),[G]);return"minimal"===C?(0,t.jsx)(_.motion.a,{href:"/highlights/".concat(b.storyId),className:(0,x.cn)("flex rounded-xl hover:bg-surface-l1-hover","group cursor-pointer relative overflow-hidden px-3"),onClick:q,variants:{rest:{paddingTop:16,paddingBottom:16},hover:{paddingTop:20,paddingBottom:20}},initial:"rest",whileHover:void 0,transition:{duration:.1,ease:"easeOut"},children:(0,t.jsxs)(_.motion.div,{layout:!0,className:"flex gap-4 flex-1",initial:!1,animate:{height:"auto"},transition:{duration:.1,ease:"easeOut"},children:[(0,t.jsxs)("div",{className:"flex flex-col justify-between flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold line-clamp-2 leading-tight m-0",children:b.title}),(0,t.jsx)("div",{className:(0,x.cn)("mt-2 text-secondary text-sm line-clamp-2 opacity-0 group-hover:opacity-100 transition-opacity","!opacity-0"),children:b.summary||"trend"===T&&b.grokAnalysis})]}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 items-center mt-2",children:[O&&(0,t.jsx)("div",{className:"text-secondary text-sm",children:O}),"trend"===T&&(0,t.jsx)(r.Bird,{className:"w-4 h-4 text-secondary"}),(0,t.jsx)("div",{className:(0,x.cn)("opacity-0 group-hover:opacity-100",!1),children:(0,t.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:Q,className:(0,x.cn)("liked"===U&&"text-primary"),"aria-label":"Like this story",children:(0,t.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:W,className:(0,x.cn)("disliked"===U&&"text-primary"),"aria-label":"Dislike this story",children:(0,t.jsx)(n.ThumbsDownIcon,{className:"size-4"})})]})})]})]}),(0,t.jsx)(_.motion.div,{className:(0,x.cn)("shrink-0 w-[160px] relative self-start",!R&&!F&&"hidden"),variants:{rest:{height:96},hover:{height:120}},transition:{duration:.1,ease:"easeOut"},children:(0,t.jsx)(_.motion.div,{layout:!0,className:"absolute top-0 right-0 w-[128px] h-[96px] rounded-xl overflow-hidden",initial:!1,variants:{rest:{width:128,height:96},hover:{width:160,height:120}},transition:{duration:.1,ease:"easeOut"},children:R?(0,t.jsx)(c.Skeleton,{className:"w-full h-full rounded-xl"}):F&&(0,t.jsx)("img",{src:z,alt:b.title||E("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>P(!0)})})})]})}):(0,t.jsxs)("a",{href:"/highlights/".concat(b.storyId),className:(0,x.cn)("grid gap-y-2 gap-x-4",F?"grid-cols-[1fr_fit-content(200px)] grid-rows-[auto_24px]":"grid-cols-[1fr] grid-rows-[auto_24px]","overflow-hidden",k?"bg-transparent rounded-2xl":"border rounded-3xl bg-surface-l1","hover:bg-surface-l4-hover dark:hover:bg-surface-l2","ps-4 pe-3 py-3","w-full min-h-[90px]","text-start"),onClick:q,children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5 overflow-hidden col-span-1 row-span-1",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg line-clamp-2 leading-tight m-0",children:b.title}),"authors"===C?(0,t.jsxs)(t.Fragment,{children:[b.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0 mt-1",children:b.summary}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-auto overflow-hidden",children:[(0,t.jsx)("div",{className:"flex gap-1.5 flex-nowrap overflow-hidden flex-shrink min-w-0",children:K.map((e,s)=>(e.name,e.username,e.profileImageUrl,e.verifiedType,e.verifiedType,(0,t.jsxs)("div",{className:(0,x.cn)("flex items-center gap-1.5","ps-1 pe-2 py-1 rounded-full","bg-surface-l2 hover:bg-surface-l3","border border-border-l1","cursor-pointer transition-all","flex-shrink-0"),onClick:t=>{t.stopPropagation(),t.preventDefault(),e.postId&&(M("highlight_author_pill_clicked",e.postId,{location:"highlights-story-card:HighlightsStoryRow:authorPill",storyId:b.storyId||"",username:e.username,postId:e.postId}),window.open("https://x.com/".concat(e.username,"/status/").concat(e.postId),"_blank"))},children:[(0,t.jsx)("div",{className:"relative size-5 rounded-full bg-surface-l3 overflow-hidden flex-shrink-0",children:e.profileImageUrl?(0,t.jsx)("img",{src:e.profileImageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:(0,x.cn)("w-full h-full flex items-center justify-center","bg-gradient-to-br from-purple-500/30 via-blue-500/30 to-pink-500/30","text-primary text-[10px] font-medium"),children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("span",{className:"text-xs text-primary font-medium",children:["@",e.username]})]},e.username)))}),G.length>K.length&&(0,t.jsx)("div",{className:(0,x.cn)("flex items-center gap-1.5 flex-shrink-0"),children:(0,t.jsxs)("span",{className:"text-xs text-secondary font-medium whitespace-nowrap",children:["+",E("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:G.length-K.length})]})})]})]}):(0,t.jsxs)(t.Fragment,{children:[G.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm mt-1",children:[(0,t.jsxs)("span",{children:["@",null==(I=G[0])?void 0:I.username]}),G.length>1&&(0,t.jsxs)("span",{className:"text-xs",children:["+",E("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:G.length-1})]})]}),b.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0",children:b.summary})]})]}),F&&(0,t.jsx)("div",{className:"col-span-1 row-span-2 flex items-center justify-end",children:(0,t.jsx)("div",{className:"relative w-[200px] h-full max-h-[200px] rounded-xl overflow-hidden bg-surface-l2",children:(0,t.jsx)("img",{src:z,alt:b.title||E("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>P(!0)})})}),(0,t.jsxs)("div",{className:"flex items-center h-min gap-4 text-secondary self-end text-xs col-span-1 row-span-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:Q,className:(0,x.cn)("liked"===U&&"text-primary"),"aria-label":"Like this story",children:(0,t.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:W,className:(0,x.cn)("disliked"===U&&"text-primary"),"aria-label":"Dislike this story",children:(0,t.jsx)(n.ThumbsDownIcon,{className:"size-4"})})]}),V>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.ChartBar,{className:"size-4 scale-x-[-1] rotate-90"}),(0,t.jsx)("span",{children:(0,y.formatNumber)(V)})]}),X>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(l.HeartIcon,{className:"size-4"}),(0,t.jsx)("span",{children:(0,y.formatNumber)(X)})]}),(0,t.jsx)("span",{children:O})]})]})}function T(e){let{className:r,story:o}=e,{t:l}=(0,p.useTranslation)("chat"),c=(0,g.useLogEvent)(),j=(0,f.useRef)(null),I=(0,f.useRef)(!1),b=(0,S.useHighlightsStore)(e=>e.storyReactions),{discussionPosts:_,isLoading:C,hasMore:T,loadMore:L}=k(o.storyId),P=(0,f.useRef)(null),M=b[o.storyId||""],{data:E=[],isLoading:A}=w(o.storyId),{data:H=[]}=N(o.storyId),R=(0,f.useMemo)(()=>[...E].sort((e,t)=>{var s,i;return((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)}),[E]),B=(0,f.useRef)(null),[D,z]=(0,f.useState)(!0),[F,U]=(0,f.useState)(!1);(0,f.useEffect)(()=>{B.current&&R.length>0&&U(B.current.scrollHeight>392)},[R]);let O=(0,f.useMemo)(()=>{if(A||0===E.length)return;let e=E.reduce((e,t)=>Math.max(e,new Date(t.createTime||0).getTime()),0),t=Math.floor((Date.now()-e)/6e4);return 0===t?l("highlights-less-than-minute-ago","<1 minute ago"):t<60?l("highlights-minutes-ago","{{count}} minutes ago",{count:t}):l("highlights-hours-ago","{{count}} hours ago",{count:Math.floor(t/60)})},[E,A,l]),V=(0,f.useMemo)(()=>{let e=new Set(E.map(e=>e.postId).filter(Boolean));return H.filter(t=>!e.has(t.postId))},[H,E]),X=(0,f.useMemo)(()=>{let e=[...V,..._],t=new Set;return e.filter(e=>!(!e.postId||t.has(e.postId))&&(t.add(e.postId),!0))},[V,_]),G=(0,f.useCallback)(e=>{P.current&&P.current.disconnect(),e&&(P.current=new IntersectionObserver(e=>{let[t]=e;t&&t.isIntersecting&&T&&!C&&L().catch((0,m.createLogError)("highlights-story-card:loadMoreDiscussionPosts"))},{threshold:.1,rootMargin:"0px 0px 200px 0px"}),P.current.observe(e))},[T,C,L]);(0,f.useEffect)(()=>()=>{P.current&&P.current.disconnect()},[]);let q=(0,f.useMemo)(()=>{let e=[];return E.forEach(t=>{var s,i;let r=(null==(s=t.entities)?void 0:s.media)||[],o=[];if(r.forEach(e=>{let t=e.url||e.previewImageUrl;t&&o.push(t)}),o.length>0){let s=(null==(i=t.publicMetrics)?void 0:i.likeCount)||0;e.push({post:t,images:o,likeCount:s})}}),e.sort((e,t)=>t.likeCount-e.likeCount).flatMap(e=>e.images)},[E]),Q=(0,f.useMemo)(()=>E.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[E]);(0,f.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!I.current&&(I.current=!0,c("highlights_story_impression",o.storyId||"",{location:"highlights-section:HighlightsSection:impression",storyId:o.storyId||"",title:o.title||""}))})},{threshold:0});return j.current&&e.observe(j.current),()=>{e.disconnect()}},[o.storyId,o.title,c]);let W=(0,f.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!o.storyId)return;let t=S.useHighlightsStore.getState();c("highlight_story_liked",o.storyId,{location:"highlights-section:HighlightsSection:handleLike",storyId:o.storyId,title:o.title||"",wasAlreadyLiked:String("liked"===M)}),t.likeStory(o.storyId)},[o.storyId,o.title,M,c]),K=(0,f.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!o.storyId)return;let t=S.useHighlightsStore.getState();c("highlight_story_disliked",o.storyId,{location:"highlights-section:HighlightsSection:handleDislike",storyId:o.storyId,title:o.title||"",wasAlreadyDisliked:String("disliked"===M)}),t.dislikeStory(o.storyId)},[o.storyId,o.title,M,c]),Y=(0,f.useCallback)(e=>{c("highlights_post_link_clicked",e,{location:"highlights-section:HighlightsSection:handlePostClick",storyId:o.storyId||"",postId:e})},[o.storyId,c]);return(0,t.jsxs)("section",{ref:j,id:o.storyId||void 0,className:(0,x.cn)("w-full scroll-mt-4",h.QUERY_BAR_MAX_WIDTH_CLASS,r),children:[q.length>0&&(0,t.jsxs)("div",{className:"relative w-full mb-6 rounded-2xl overflow-hidden",children:[(0,t.jsx)("img",{src:q[0],alt:"","aria-hidden":"true",className:"absolute inset-0 w-full h-full object-cover blur-3xl scale-110 opacity-60"}),(0,t.jsx)("img",{src:q[0],alt:o.title||l("highlights-story-image","Story image"),className:"relative w-full h-auto max-h-[600px] object-contain"})]}),(0,t.jsx)("h2",{className:"text-primary font-semibold text-2xl mb-2 m-0",children:o.title}),V.length>0&&(0,t.jsx)("div",{className:"mb-4 space-y-3",children:o.summary&&(0,t.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:o.summary})}),!V.length&&o.summary&&(0,t.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:o.summary}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:W,className:(0,x.cn)("liked"===M&&"text-primary"),"aria-label":l("highlights-like-story","Like this story"),children:(0,t.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,t.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:K,className:(0,x.cn)("disliked"===M&&"text-primary"),"aria-label":l("highlights-dislike-story","Dislike this story"),children:(0,t.jsx)(n.ThumbsDownIcon,{className:"size-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm",children:[Q>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:l("highlights-views",{count:Q,formattedCount:(0,y.formatNumber)(Q),defaultValue_one:"{{formattedCount}} view",defaultValue_other:"{{formattedCount}} views"})}),(0,t.jsx)("span",{children:"Â·"})]}),O&&(0,t.jsx)("span",{children:O})]})]}),R.length>0&&(0,t.jsxs)("div",{className:(0,x.cn)("mb-8",D&&F&&"max-h-96 overflow-hidden relative"),ref:B,children:[(0,t.jsx)("div",{className:"flex flex-col overflow-hidden",children:R.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{onClick:()=>{D?z(!1):Y(e.postId||"unknown")},className:(0,x.cn)(D&&"cursor-pointer"),children:(0,t.jsx)(i.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0,disabled:D})}),s<R.length-1&&(0,t.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||s))}),D&&F&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-surface-base to-transparent flex items-end justify-center pb-2",children:(0,t.jsx)(d.Button,{variant:"secondary",size:"sm",onClick:()=>z(!1),children:l("highlights.show-more","Show more")})})]}),o.grokAnalysis&&(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)(v.MessageBubble,{isUser:!1,children:(0,t.jsx)(s.MemoizedMarkdown,{sender:"assistant",shouldRenderHtml:!0,children:o.grokAnalysis})})}),X.length>0&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg mb-4",children:l("highlights-what-the-world-is-saying","What the world is saying")}),(0,t.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[X.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsx)(i.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0}),s<X.length-1&&(0,t.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||"discussion-".concat(s))),(0,t.jsx)("div",{ref:G,className:"w-full h-1"}),C&&(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(u.Spinner,{size:"sm"})})]})]})]})}},796066,e=>{"use strict";e.s(["useLoadHighlights",()=>o]);var t=e.i(353315),s=e.i(572848),i=e.i(676452),r=e.i(50636);function o(){let e=(0,s.useSession)().user,o=(0,r.useFeatureFlags)(),l=(0,i.useHighlightsStore)(e=>e.isLoading),n=(0,i.useHighlightsStore)(e=>e.error);return(0,t.useEffect)(()=>{if(!o.ALLOW_HIGHLIGHTS_ACCESS_WEB)return;let t=i.useHighlightsStore.getState();t.stories.length>=10||e&&!t.isLoading&&t.fetchStories(10).catch(e=>{})},[e,o.ALLOW_HIGHLIGHTS_ACCESS_WEB]),{isLoading:l,error:n}}},829735,584675,e=>{"use strict";e.s(["HighlightsAllStoriesPage",()=>D,"default",()=>B],829735);var t=e.i(637651),s=e.i(353315);e.i(968648);var i=e.i(873329),r=e.i(211959),o=e.i(486492),l=e.i(920958),n=e.i(235289),a=e.i(676452),h=e.i(796066),d=e.i(398459),c=e.i(724499),u=e.i(258722);e.i(685846);var g=e.i(352910),m=e.i(763578),y=e.i(380619),x=e.i(246429),f=e.i(389052),p=e.i(892621);e.s(["ArrowLeft",()=>v.default],584675);var v=e.i(688893),v=v,S=e.i(383293),j=e.i(383274),I=e.i(572848),b=e.i(443696),w=e.i(723008),N=e.i(713087),k=e.i(50636),_=e.i(328788),C=e.i(243634),T=e.i(157695),L=e.i(230433),P=e.i(805546),M=e.i(470753),E=e.i(6880),A=e.i(112089);function H(){let{t:e}=(0,i.useTranslation)("chat"),h=(0,E.useParams)(),{route:g}=(0,c.useRouting)(),m="highlights"===g.page&&g.storyId||(null==h?void 0:h.id),H=(0,l.useLogEvent)(),{user:R}=(0,I.useSession)(),B=(0,j.useMaybeRefreshAnonSession)(),{signInWithReturnTo:D}=(0,N.useGrokRouter)(),z=(0,C.useForceSignInModels)(),F=(0,k.useFeatureFlags)(),U=(0,M.useSettingsStore)(e=>e.isIncognito),O=(0,_.useMobileSize)(),{bestSubscription:V}=(0,L.useSubscriptions)(),X=(0,P.useIsFirstTimeUser)(),G=(0,a.useHighlightsStore)(e=>e.getStory),q=(0,s.useMemo)(()=>m?G(m):void 0,[G,m]),{data:Q,isUninitialized:W,isLoading:K,error:Y}=(0,T.usePromise)(q),{data:J=[]}=(0,A.useSourcePosts)(m),{data:Z=[]}=(0,A.useEngagingPosts)(m),{sessionStartTime:$,conversationDepth:ee}=(0,p.useTimeToValueAnalytics)();(0,s.useEffect)(()=>{Q&&H("highlight_story_page_view",m,{location:"highlight-story-page",storyId:m,title:Q.title||""})},[Q,m,H]);let et=(0,s.useCallback)(e=>{let{query:t,fileAttachmentIds:s,toolOverrides:i,workspaceIds:r,persona:l,isIncognitoOverride:n,disableMemory:a,modelIdOverride:h}=e;if(!t||!t.trim())return Promise.resolve(!1);let d=x.useChatPageStore.getState(),c=M.useSettingsStore.getState(),g=u.useRoutingStore.getState();return!R&&z.includes(d.activeModelId)?(H("sign_in","highlight-story-page",{location:"highlight-story-page:handleSend"}),D(t),Promise.resolve(!1)):B().then(()=>{let e=(0,f.toAnalytics)({activeModelId:h||d.activeModelId,modelMode:h?"":void 0,query:t,fileAttachmentIds:s,location:"highlight-story-page",personalityId:c.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:$,conversationDepth:ee,isMobile:O,bestSubscription:V,user:!!R,workspaceCount:(null==r?void 0:r.length)||0,toolOverrides:i,parentResponseId:"",isFirstTimeUser:X}),u=J.map(e=>e.postId),m=Z.slice(0,2).map(e=>"@".concat(e.username,": ").concat(e.text)),y=[(null==Q?void 0:Q.title)&&"Story: ".concat(Q.title),m&&m.length>0&&"Popular responses: ".concat(m.join(" | ")),!(null==m?void 0:m.length)&&(null==Q?void 0:Q.summary)&&"Summary: ".concat(Q.summary),u&&"X posts: ".concat(u.join(", ")),t].filter(Boolean).join("\n\n");H("send_query","",e);let x=null!=n?n:U;return d.establishNewConversation({message:y,fileAttachmentIds:s,toolOverrides:i,temporary:x,enableRetries:!0,ff:F,persona:l,disableMemory:a,onOptimisticConversation:()=>{g.push({page:"main"})}}).catch((0,o.createLogError)("highlight-story-page:establishNewConversation")).then(e=>!!e)})},[R,z,B,H,D,$,ee,O,V,X,J,Z,null==Q?void 0:Q.title,null==Q?void 0:Q.summary,U,F]),es=(0,s.useCallback)(()=>{(0,u.useRoutingStore.getState().push)({page:"main"})},[]);return W||K?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)(w.Spinner,{})}):Y||!Q?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("div",{className:(0,r.cn)("w-full",n.QUERY_BAR_MAX_WIDTH_CLASS),children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlight-not-found","Highlight story not found.")})})}):(0,t.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh]",y.CHAT_CONTAINER_CLASSES),children:[(0,t.jsx)("div",{className:"flex-1 w-full overflow-y-auto",children:(0,t.jsxs)("div",{className:(0,r.cn)("w-full",n.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4 relative"),children:[(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(b.Button,{variant:"tertiary",size:"md",shape:"circle",onClick:es,className:"shrink-0","aria-label":e("highlights-detail-page.back","Back"),children:(0,t.jsx)(v.default,{size:20})})}),(0,t.jsx)(d.HighlightsSection,{className:"pt-3",story:Q}),(0,t.jsx)("div",{className:"h-32"})]})}),(0,t.jsxs)("div",{className:(0,r.cn)("absolute bottom-4 w-full"),children:[(0,t.jsx)(S.QueryBar,{placeholder:e("highlights-story-page-query-bar.input-placeholder","Ask about the story..."),onQuery:et,onFrontPage:!0,isIncognito:U,textAreaClassName:"min-h-14 py-4 my-0 mb-0"}),(0,t.jsx)("div",{className:"absolute -bottom-4 h-14 w-full",children:(0,t.jsx)("div",{className:(0,r.cn)("chat-input-backdrop w-full h-full","bg-gradient-to-b from-surface-base via-surface-base/94 to-surface-base/80")})})]})]})}function R(e){let{children:s}=e,i=(0,u.useRoutingStore)(e=>e.push);return(0,t.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh] overflow-y-auto",y.CHAT_CONTAINER_CLASSES),children:[(0,t.jsx)(m.Button,{variant:"outline",size:"iconMd",rounded:!0,onClick:()=>i({page:"main"}),className:"shrink-0 mt-2 ms-2 self-start sticky top-2",children:(0,t.jsx)(g.ChevronLeft,{className:"size-4"})}),(0,t.jsx)("div",{className:(0,r.cn)("w-full",n.QUERY_BAR_MAX_WIDTH_CLASS),children:s})]})}function B(){let{route:e}=(0,c.useRouting)();return"highlights"===e.page&&e.storyId?(0,t.jsx)(H,{}):(0,t.jsx)(D,{})}function D(){let{t:e}=(0,i.useTranslation)("chat"),{route:r}=(0,c.useRouting)(),n=(0,a.useHighlightsStore)(e=>e.stories),{isLoading:u,error:g}=(0,h.useLoadHighlights)(),m=(0,l.useLogEvent)();return((0,s.useEffect)(()=>{n.length>0&&m("highlights_shown",String(n.length),{location:"highlights-page:HighlightsAllStoriesView",storyCount:String(n.length)})},[n.length,m]),(0,s.useEffect)(()=>{if("highlights"===r.page&&r.storyId){let e=setTimeout(()=>{let e=r.storyId;if(e){let t=document.getElementById(e);t?t.scrollIntoView({behavior:"smooth",block:"start"}):(0,o.logError)("highlights-page:scroll",Error("Story element not found: ".concat(e)))}},100);return()=>clearTimeout(e)}},[r]),u&&0===n.length)?(0,t.jsx)(R,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-loading","Loading highlights...")})})}):g?(0,t.jsx)(R,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-error","Failed to load highlights. Please try again later.")})})}):0===n.length?(0,t.jsx)(R,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-empty","No highlights available at the moment.")})})}):(0,t.jsx)(R,{children:(0,t.jsx)("div",{className:"flex flex-col gap-10",children:n.map(e=>(0,t.jsx)(d.HighlightsSection,{story:e},e.storyId))})})}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="6bad164f-855c-5460-a951-c3c01a60ce29")}catch(e){}}();
//# debugId=6bad164f-855c-5460-a951-c3c01a60ce29
